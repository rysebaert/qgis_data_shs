---
title: "Initiation au traitement de l'information géographique dans un environnement SIG (QGIS)"
subtitle: "Journées Data SHS - PUD Lille - Décembre 2022"
author:  
- "Ronan Ysebaert - UAR RIATE, Université Paris Cité / Violaine Jurie (Géoteca, Université Paris Cité)"
date: "Dernière mise à jour: `r Sys.Date()`"
output:
  xaringan::moon_reader:
    self_contained: true
    css: ["xaringan-themer.css", "css/rutgers-tidyverse.css"]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      highlightSpans: true
      countIncrementalSlides: false
      ratio: "16:9"
    seal: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE, crayon.enabled = TRUE)
knitr::opts_chunk$set(cache = FALSE,
                      fig.align='center',
                      message = FALSE,
                      warning = FALSE,
                      Encoding = "UTF-8")
# install.packages("devtools")
#devtools::install_github("gadenbuie/countdown")
#devtools::install_github("mitchelloharawild/icons")
library(countdown)
library(fontawesome)
```

class: inverse middle center

#  Déroulé

---
class: middle

.pull-left[

### Information géographique ?  (*9h - 9h45*)

- Les composantes de l'information géographique
- Où en trouver ?
- Formats de fichiers


### Systèmes d'Information Géographiques ? (*9h45 - 10h30*)

- Bref historique du développement des SIG
- Principes et fonctionnalités
- Principaux SIG
- Présentation de QGIS

#### Pause 10h30-10h45


]

.pull-right[.center-right[
###  Systèmes de coordonnées de référence, projections *(10h45 - 11h15)*

- Qu'est-ce qu'une projection ?
- Gérer les projections de ses couches géographiques dans QGIS 

### Manipulations de base (données vectorielles) *(11h15 - 12h30)*
- Import de données tabulaires
- Jointure attributaire
- Jointure spatiale
- Sélections attributaires

#### Déjeuner 12h30 - 13h30

]
]
---
class: middle

.pull-left[.center-left[
### Géotraitements *13h30 - 14h30*
- Présentation des géotraitements 
- Cas d'usage de géotraitements

### Mise en cohérence des critères *14h30-14h45*
- Modéliser sa chaîne de traitement
- Identifier une localisation optimale

### Mettre en page une carte *14h45 - 15h30*
- Eléments fondamentaux sur l'habillage cartographique
- Créer une mise en page avec QGIS


#### Pause 15h30-15h45


]]

.pull-right[.center-right[

### Cartographie thématique dans QGIS 15h45 - 16h30
- Typologies (symboles catégorisés)
- Cartes choroplèthes (symboles gradués)

### Prolongements (non abordé dans le détail) 16h30 - 16h40

- Digitalisation
- Statistiques spatiales
- Quelques mots sur les outils dédiés à la cartographie thématique (Magrit)

### Moment d'échange

]]

---

.left-column[

## Atelier

*Implantation d'une piste de* ***roller-derby*** *dans la Métropole Européenne de Lille*


.medium[

4 critères proposés :
- **Minimser les frais** : Un gymnase préexistant qui présente de bonnes prédispositions (taille, type d'activité).
- **Favoriser l'inclusion sociale** : un territoire dont le revenu médian se situe sous la moyenne de la Métropole Européenne de Lille.  
- **Optimisation de localisation** : Plus de 2000 m à vol d'oiseau d'un équipement existant.
- **Ouvrir aux jeunes populations** : au moins 5 écoles dans un voisinage géographique de 1000m.
]
]

.right-column[
<center>
<img src="fig/rouler_glisser.PNG" width="400" />
</center>
]


---
## Télécharger les données de l'atelier : <a href="https://github.com/rysebaert/qgis_data_shs" target="_blank">https://github.com/rysebaert/qgis_data_shs</a>

Puis cliquez sur *data > data.zip > download*

![](fig/git.PNG)

--- 

---
## Données à disposition
.left-column[

.medium[

### Découpages géographiques 

Le découpage géographique 2019 des IRIS et des communes (polygones) de la Métropole Européenne de Lille. (Source : <a href="https://geoservices.ign.fr/adminexpress" target="_blank">Admin Express, IGN</a>).

*Fichiers : [data/GEOM/IRIS_METRO_LILLE.shp et data/GEOM/COMMUNES_METRO_LILLE.shp]*

]
]
.right-column[
<center>
```{r, eval = TRUE, echo = FALSE, message=FALSE, warning=FALSE, fig.height=7}
library(sf)
library(mapsf)
library(readxl)

iris <- st_read("data/GEOM/IRIS_METRO_LILLE.shp", quiet = TRUE)
com <- st_read("data/GEOM/COMMUNES_METRO_LILLE.shp", quiet = TRUE)
gym <- st_read("data/GEOM/gym_osm.shp", quiet = TRUE)
school <- st_read("data/GEOM/LILLE_ECOLE.shp", quiet = TRUE)

df <- read_excel("data/STAT/data_INSEE.xlsx")
df <- aggregate(df[,"P18_POP"], by = list(df$INSEE_COM), FUN = sum)
com <- merge(com, df, by.x = "INSEE_COM", by.y = "Group.1", all.x = TRUE)
com <- com[order(com$P18_POP, decreasing = TRUE),]
gym <- st_transform(gym, 2154)
school <- st_transform(school, 2154)

mf_shadow(com)
mf_map(iris, border = "white", col = "peachpuff", lwd = .25, add = TRUE)
mf_map(com, col = NA, add = TRUE)
mf_label(com[1:4,], var = "NOM_COM", halo = TRUE)
mf_scale(size = 5)
mf_credits("Ronan Ysebaert, Violaine Jurie, 2022\nSource: IGN, 2022")
mf_title("Contour des IRIS et des communes")

```
</center>

]

---
## Données à disposition
.left-column[

.medium[

### Gymnases  

L'emprise géographique des gymnases (polygones) et quelques attributs associés : surface, nom, type de sport pratiqués dans le gymnase (Source : <a href="https://www.openstreetmap.org/#map=11/50.6273/3.0563" target="_blank">OpenStreetMap</a>, librairie R<a href="https://cran.r-project.org/web/packages/osmdata/index.html" target="_blank">`osmdata`</a>)

*Fichier : [data/GEOM/gym_osm.shp]*

]
]
.right-column[
<center>
```{r, eval = TRUE, echo = FALSE, message=FALSE, warning=FALSE, fig.height=7, fig.align='center'}

mf_shadow(com)
mf_map(com, col = "peachpuff", add = TRUE)
mf_map(gym, col = "lightcoral", border = "lightcoral", add = TRUE)
mf_map(st_centroid(gym[gym$rllr_sk == 1,], 100), col = "red", border = "red", cex = 2, add = TRUE)
mf_legend(type = "typo", val = c("Gymnases", "Activité roller derby identifiée"), 
          pal = c("lightcoral", "red"), title = "", pos = "topleft")
mf_label(com[1:4,], var = "NOM_COM", halo = TRUE)
mf_scale(size = 5)
mf_credits("Ronan Ysebaert, Violaine Jurie, 2022\nSource: (c) OpenStreetMap et contributeurs, 2022")
mf_title("Emprise des gymnases")
```
</center>
]

---

## Données à disposition
.left-column[

.medium[

### Écoles élémentaires

La localisation (points) des écoles élémentaires en 2018 (Source : <a href="https://www.insee.fr/fr/statistiques/3568638?sommaire=3568656
" target="_blank">Dénombrement des équipements en 2021, INSEE</a>)

*Fichier : [data/GEOM/LILLE_ECOLE.shp]*

]
]
.right-column[
<center>
```{r, eval = TRUE, echo = FALSE, message=FALSE, warning=FALSE, fig.height=7, fig.align='center'}
mf_shadow(com)
mf_map(com, col = "peachpuff", add = TRUE)
mf_map(school, col = "blue", border = "blue", add = TRUE)
mf_label(com[1:4,], var = "NOM_COM", halo = TRUE)
mf_scale(size = 5)
mf_credits("Ronan Ysebaert, Violaine Jurie, 2022\nSource : Base Permanente des Équipements (INSEE), 2022")
mf_title("Localisation des écoles primaires")
```
</center>
]


---

## Données à disposition
.left-column[

.medium[

### Revenu de la population

Le revenu médian de la population en 2019 à l'échelle des IRIS / Communes. (Source : Source : <a href="https://www.insee.fr/fr/statistiques/6049648
" target="_blank">Revenu, pauvreté et niveau de vie en 2019 (Iris), INSEE</a>)

*Fichier : [data/STAT/data_INSEE.xlsx]*

]
]
.right-column[

<center>
```{r, eval = TRUE, echo = FALSE, message=FALSE, warning=FALSE, fig.height=7, fig.align='center'}
df <- read_excel("data/STAT/data_INSEE.xlsx")
iris <- merge(iris, df[,c("CODE_IRIS", "DEC_MED19")], by.x = "CODE_IRIS", by.y = "CODE_IRIS", all.x = TRUE)

mf_shadow(com)
mf_map(x = iris, var = "DEC_MED19", type = "choro", pal = "RdBu", breaks = "quantile",
       nbreaks = 8, border = NA, leg_val_rnd = -2, leg_title = "Revenu médian 2019",
       add = TRUE)
mf_map(com, col = NA, add = TRUE)
mf_label(com[1:4,], var = "NOM_COM", halo = TRUE)
mf_title("Revenus")
mf_scale(size = 5)
mf_credits("Ronan Ysebaert, Violaine Jurie, 2022\nSource : INSEE, 2022")
```
</center>
]



---

class: inverse middle center

#  Information géographique ? 

Les composantes de l'information géographique 

Où en trouver ?

Formats de fichiers


---

## Information Géographique ? 

.pull-left[
L'information géographique peut être définie comme «**l'ensemble de la description d'un objet et de sa position géographique à la surface de la Terre.**» (*Association Française pour l'Information Géographique*). C'est une information **localisée dans l'espace**.

Toute information contenant une référence à un localisation, qu’il s’agisse d’un **point** précis du territoire, d’**une ligne** (route, frontière, cours d'eau) ou encore d’**une surface** (aire protégée, zone d’emploi, commune...) **a une dimension géographique**.

Entre **60 et 80%** de l’information que nous traitons possède une dimension géographique. (*Hahmann S. et Burghardt D., 2012, « How much information is geospatially referenced? Networks and cognition »*).
]

.pull-right[
La force des données géographiques est de **pouvoir les croiser** entre elles lorsqu'elles partagent un même socle géographique. On crée ainsi de la **donnée à valeur ajoutée** préparant la prise de décision (*Ministère de la Transition écologique et de la Cohésion des Territoires, 2019*).

]


---

## Les composantes de l'information géographique

```{r, echo = FALSE, out.width = "900px", fig.align='center'}

library(DiagrammeR)

grViz("digraph dot {

  # a 'graph' statement
  graph [overlap = true]

  # several 'node' statements
  node [shape = rectangle, fontname = Helvetica, color='#9c2005', fontsize=13]
  d1

  node [shape = ellipse, fontname = Helvetica, color=black, fontsize = 9] // sets as circles
  d2; d3; d4
  
  d1 [label = 'Données géographiques'];
  d2 [label = 'Niveau sémantique'];
  d3 [label = 'Niveau géométrique'];
  d4 [label = 'Niveau topologique'];

  # several 'edge' statements
  d1->d2[arrowhead = none]
  d1->d3[arrowhead = none]
  d1->d4[arrowhead = none] 

}")
```

---

## Niveau géométrique

Le **niveau géométrique** d'un objet géographique correspond à **sa forme et sa localisation** sur la surface terrestre, exprimés dans un **système de coordonnées** explicite.
   

```{r, echo = FALSE, out.width = "900px"}
knitr::include_graphics('fig/geom.png')
```

---

## Niveau géométrique

Pour stocker, manipuler, analyser et représenter de l'information géographique, on distingue généralement 2 types de données : le raster et le vecteur. 

.pull-left[


### Le raster  

**c'est une image** (plan scanné, photographie aérienne, image satellitaire...) **localisée dans l'espace**. 

L’information géographique est alors stockée dans des cellules (pixel) contiguës généralement carrées. 

Chaque pixel **défini par une résolution** possède des valeurs qui peuvent être traitées et cartographiées. 

La manipulation des rasters nécessite des méthodes et des outils spécialisés.    
]

.pull-right[
<span style="color:#9c2005;font-weight:bold;">Raster</span>  
<img src="fig/raster.PNG" width="512" />
</div>

]

---

## Niveau géométrique

Pour stocker, manipuler, analyser et représenter de l'information géographique, on distingue généralement 2 types de données : le raster et le vecteur. 


### Le vecteur

.pull-left[
**Le format vectoriel** utilise le concept d'**objets géométriques (points, lignes, polygones) pour représenter (et stocker) des objets géographiques**. 

Les objets vectoriels ne ne pixellisent pas. On parlera néanmoins de **niveaux de généralisation** pour qualifier leur niveau de précision (parfois aussi appelée résolution).

Leur manipulation est simple et permet de puissants traitements.    

]


.pull-right[

<div class="centered">
<span style="color:#9c2005;font-weight:bold;">Vecteur</span>  
<img src="fig/vecteur.PNG" width="400" />
</div>
</div>

]


---

## Niveau géométrique

Pour stocker, manipuler, analyser et représenter de l'information géographique, on distingue généralement 2 types de données : le raster et le vecteur. 

```{r, echo = FALSE, out.width = "700px", fig.align='center', message=FALSE}
knitr::include_graphics('fig/raster_vecteur_2.png')
```


---

## Niveau topologique

Le niveau topologique  **d'un objet géographique se déduit du niveau géométrique**. Il correspond aux relations éventuelles avec d'autres objets ou phénomènes (ex : contiguïté entre deux bâtiments).


```{r, echo = FALSE, fig.align='center', out.width = "500px"}
knitr::include_graphics('fig/topologie.gif')
```


---

## Niveau sémantique

**Il s'agit de l'ensemble des informations relatives à un objet géographique, qui le décrivent et le caractérisent**. Elles sont souvent nommées données attributaires.
<br>

```{r, echo = FALSE, out.width = "800px", fig.align='center'}
knitr::include_graphics('fig/attribut.gif')
```


---

## Niveau sémantique

**Il s'agit de l'ensemble des informations relatives à un objet géographique, qui le décrivent et le caractérisent**. Elles sont souvent nommées données attributaires.
<br>


```{r, echo = FALSE, out.width = "700px", fig.align='center'}
knitr::include_graphics('fig/attribut.png')
```


---

.pull-left[

## Les sources de l'IG (France)

### Un incontournable : l'Institut Géographique National

- [Géoservices de l'IGN](https://geoservices.ign.fr/telechargement)  
- [Géoportail (portail nationnal d’accès à l’information géographique de référence)](https://www.geoportail.gouv.fr/)    


### Les organismes publics et les collectivités territoriales

- [Bureau de Recherches Géologiques et Minières (BRGM)](http://infoterre.brgm.fr)          
- [Agence de l'Environnement et de la Maîtrise de l'Energie (ADEME)](https://data.ademe.fr/)          
- [Office national des forêts](https://www.onf.fr/onf/connaitre-lonf/+/35::open-data-pour-mieux-partager-les-donnees-forestieres.html)
- Portail Open Data des régions : [Ile-de-France](https://data.iledefrance.fr/pages/home/), [Hauts-de-France](https://opendata.hautsdefrance.fr/), [Bretagne](https://data.bretagne.bzh/pages/home-page/), etc.    
- Portail Open Data des Métropoles : [Métropole du Grand Paris](https://metropole-grand-paris.opendata.arcgis.com/), [Métropole Européenne de Lille](https://opendata.lillemetropole.fr/page/home/), [Rennes Métropole](https://data.rennesmetropole.fr/explore/?sort=modified), etc.
- ...
]

.pull-right[
## Au niveau international

- [Eurostat - GISCO](https://ec.europa.eu/eurostat/web/gisco/geodata/reference-data)
- [Copernicus](https://land.copernicus.eu/)
- [Natural Earth](https://www.naturalearthdata.com/)
- [World Pop](https://www.worldpop.org/)
- [OpenStreetMap (OSM)](https://www.openstreetmap.fr/), données accessibles via des API comme [Overpass-turbo](http://overpass-turbo.eu/)
- [Global Administrative Boundaries (GADM)](https://gadm.org/)
]

---

## OpenStreetMap : La plateforme collaborative de l'IG libre

OpenStreetMap (OSM) est un projet de cartographie lancé en 2004 qui a pour but de **constituer une base de données géographiques libre du monde** en utilisant le système GPS et d'autres données libres et ouvertes. **Tout le monde peut y contribuer et/ou utiliser les données**.

```{r, echo = FALSE, out.width = "960px",fig.align='center'}
knitr::include_graphics('fig/osm.png')
```


---

## OpenStreetMap : La plateforme collaborative de l'IG libre

```{r, echo = FALSE, out.width = "800px",fig.align='center'}
knitr::include_graphics('fig/barsOSM.png')
```

<p style="line-height:1.3;font-size:11pt;font-style:italic;text-align:center;">Densité des bars à Paris avec des données OSM ([T.Giraud, R Geomatic](https://rgeomatic.hypotheses.org/1244) ) </p>

---

## OpenStreetMap : La plateforme collaborative de l'IG libre

Il est au préalable important de définir la clé-valeur de l'objet OpenStreetMap désiré grâce au [wiki OpenSteetMap](https://wiki.openstreetmap.org/wiki/FR:Tag:leisure%3Dsports_centre). Ensuite d'effectuer la requête de l'objet désiré via l'[API overpass-turbo](https://overpass-turbo.eu/). 

.pull-left[

<img src="fig/osm_1.PNG" width="425" />
]

.pull-right[
<img src="fig/osm_2.PNG" width="425" />
]

Les requêtes sont envoyées sur un serveur mis à disposition gratuitement. Les requêtes doivent être raisonnables, e.g. pas sur l'ensemble du Monde. 

---

## OpenStreetMap : La plateforme collaborative de l'IG libre

On peut ensuite exporter les résultats qui répondent à cette requête. 

```{r, echo = FALSE, out.width = "800px",fig.align='center'}
knitr::include_graphics('fig/osm_3.PNG')
```

Les données OSM sont très hétérogènes par leur qualité (géométries, attributs, complétude des données). L'usage raisonné de ces données implique des enquêtes pour vérifier l'information, et compléter la base OSM le cas échéant. 

---

## Questions centrales pour rechercher de l'IG

- **Quel est mon espace d'étude ?** *Monde ? Europe ? France ? Ile-de-France ? ...*<br>

- **Quel est l'objet géographique sur lequel je travaille ?** *Pays ? Régions ? Communes ? Parcs naturels ? Rivières ? ...* <br>

- **Quelle est la thématique que je souhaite explorer ?** *Environnement ? Démographie ? Transport? ...* <br>

- **Quel est le format de données que je recherche ?** *Géométries ? Données statistiques à joindre à mes couches géographiques ?* <br>

- **Données conventionnelles ou non ? Quelle période ?**

</br>

D'un point de vue général, privilégiez l'usage de ressources gérées et maintenues par des **institutions**. 

---

## L'importance des métadonnées

.pull-left[

Avec la massification des données mises à disposition, **la documentation structurée** des données est essentielle. Elle facilite l'accès au contenu informationnel d'une ressource informatique. 

**Une métadonnée est littéralement une donnée sur une donnée. C'est un ensemble structuré d'informations décrivant une ressource** (pas spécifique à l'information géographique).

Les métadonnées synthétisent des informations élémentaires et facilitent la compréhension et l'utilisation des données : **Auteur, date de création/modification, technique de collecte, qualité, taille du fichier, unité de mesure, droits d'utilisation...**.

]

.pull-right[
```{r, echo = FALSE, out.width = "700px",fig.align='center'}
knitr::include_graphics('fig/meta.png')
```

Consulter attentivement les métadonnées associées aux données géographiques est primordial.
]


---

## Format de stockage de données vectorielles

Il existe **plusieurs formats de stockage de l'information géographique**. Les plus connus sont :</p>

.medium[
.pull-left[
- **Shapefile (.shp)** : ou « fichier de couches » est le format de fichier **historique** des (SIG). Initialement développé par ESRI pour ses logiciels commerciaux, il est devenu un standard de facto, et est utilisé par un grand nombre de logiciels libres.

- **Geographic JSON (.geojson)** : Un format ouvert d'encodage d'ensemble de données géospatiales simples utilisant la norme JSON (JavaScript Object Notation). Il permet de décrire des données de type point, ligne, chaîne de caractères, polygone et d'y ajouter des attributs d'information qui ne sont pas spatiaux. Le format GeoJSON, contrairement à la majorité des standards de systèmes d'informations géographiques, n'est pas écrit par l'Open Geospatial Consortium, mais par un groupe de travail de développeurs au travers d'internet. 
]


.pull-right[

- **GeoPackage (.gpkg)** : Un format de données géospatiales raster ou vecteur, ouvert, non propriétaire, non lié à un système d'exploitation. Conçu pour être aussi léger que possible, il permet notamment de stocker plusieurs couches géographiques dans un seul et même fichier. 


- **Keyhole Markup Language (.kml)** : ou « langage à base de balises géolocales », est fondé sur le formalisme XML et destiné à la gestion de l'affichage de données géospatiales dans les logiciels de SIG. Depuis 2008, le format est normalisé par l'Open Geospatial Consortium. Il s'agit, avec le .gpx, du format classique de données produites par GPS. 

]


]

---


## Le shapefile


Son extension est classiquement **.shp**, mais il est toujours accompagné de deux autres fichiers de même nom, mais aux extensions suivantes :


.pull-left[
- <span style="font-size:13pt;line-height:1.3;color:#9c2005;">**.dbf**</span><span style="font-size:13pt;line-height:1.3;"> : fichier qui contient les données attributaires.</span> 
- <span style="font-size:13pt;line-height:1.3;color:#9c2005;">**.shx**</span><span style="font-size:13pt;line-height:1.3;"> : fichier qui stocke l'index de la géométrie.</span>   


<p style="font-size:13pt;line-height:1.3;">D'autres fichiers peuvent être également fournis :</p>   
- <span style="font-size:12pt;line-height:1.3;color:#9c2005;">**.sbn et .sbx**</span><span style="font-size:13pt;line-height:1.3;"> : index spatial des formes.</span> 
- <span style="font-size:13pt;line-height:1.3;color:#9c2005;">**.prj**</span><span style="font-size:13pt;line-height:1.3;"> : information sur le système de coordonnées.</span> 
- <span style="font-size:13pt;line-height:1.3;color:#9c2005;">**.shp.xml**</span><span style="font-size:13pt;line-height:1.3;"> : métadonnées du shapefile.</span> 
- <span style="font-size:13pt;line-height:1.3;">Et bien d'autres encore : .sbn, .sbx, .fbn,.fbx, .cpg, .atx... </span> 
]


.pull-right[
<img src="fig/shape_ex.png" width="400" />
]


---

## Format de stockage des données attributaires

**Les données attributaires peuvent être stockées dans des formats très différents**. Les SIG acceptent d'ailleurs de nombreux formats (.txt, .csv, .dbf, .xls, .xlsx, .ods, ...) en entrée pour importer des données attributaires. Ce n'est pas l'aspect le plus important.

**L'identifiant géographique est en revanche primordial**. Il permet de faire le lien avec les géométries, et ainsi les enrichir.


```{r, echo = FALSE, out.width = "635px",fig.align='center'}
knitr::include_graphics('fig/jointure.png')
```

<p style="font-size:12pt;line-height:1.3;font-style:italic;">Dans le cas ci-dessus, on utilise l'attribut (identifiant) NomC pour joindre la couche géographique (fichier shapefile) et la table d'attributs (fichier csv par exemple).</p>


---

## Données attributaires fournies par l'INSEE


L'INSEE et l'IGN utilisent des identifiants identiques pour qualifier les objets géographiques de référence du territoire français. 


.pull-left[
<img src="fig/Excel_tab.png" width="480" />
]

.pull-right[
<img src="fig/qgis_IG.PNG" width="460" />
]

<p style="font-size:10pt;line-height:1.3;font-style:italic;">Dans les fichiers de données INSEE (à gauche) l'attribut qui sert d'identifiant unique pour les communes est nommé CODGEO (code INSEE des communes). La couche géographique des communes fournies par l'IGN (à droite), comportent le même identifiant unique nommé INSEE_COM** </p>


---

class: inverse middle center

#  Immersion dans l'univers des SIG

Historique du développement des SIG

Principes et fonctionnalités

Outils SIG

Présentation de QGIS

---

## Londres, 1854

.pull-left[
**John Snow** est un médecin britannique. Ses travaux sur la **propagation du choléra** dans le quartier de Soho à Londres en 1854 sont reconnus dans l'histoire de l'**épidémiologie moderne** et de l'**analyse spatiale**.

.left-column[
<br>
![](fig/John_snow.jpg)
]

.right-column[
.medium[
Il va identifier la **cause de l'épidémie** en utilisant un procédé simple, mais innovant, qui repose sur le principes de fonctionnement des SIG : **superposer deux couches géographiques différentes** :

- **Les lieux de résidence des décès liés à l'épidémie**.
- **Les pompes à eau** du quartier.]]  

.medium[
<br><br><br><br><br><br><br><br><br><br><br><br><br>
Il déterminera que la **transmission s'effectue par l'eau** et **identifiera le foyer de contamination** : la pompe de Brewer Street.]
]

.pull-right[
![](fig/map_snow.jpg)
.leg-fig[**Carte de John Snow** avec la localisation des lieux de résidence des personnes décédées du choléra.]
]

---

## Londres, 1854

.pull-left[
**John Snow** est un médecin britannique. Ses travaux sur la **propagation du choléra** dans le quartier de Soho à Londres en 1854 sont reconnus dans l'histoire de l'**épidémiologie moderne** et de l'**analyse spatiale**.

.left-column[
<br>
![](fig/John_snow.jpg)
]

.right-column[
.medium[
Il va identifier la **cause de l'épidémie** en utilisant un procédé simple, mais innovant, qui repose sur le principes de fonctionnement des SIG : **superposer deux couches géographiques différentes** :

- **Les lieux de résidence des décès liés à l'épidémie**.
- **Les pompes à eau** du quartier.]]  

.medium[
<br><br><br><br><br><br><br><br><br><br><br><br><br>
Il déterminera que la **transmission s'effectue par l'eau** et **identifiera le foyer de contamination** : la pompe de Brewer Street.]
]

.pull-right[
![](fig/snow_monmonier.png)
.leg-fig[Carte de John Snow revue par Mark Monmonnier, 1996]
]


---

## Un précurseur des applications SIG

.center[Si John Snow avait utilisé un système d'information géographique...]

.pull-left[
<img src="fig/snow_2.png" height="500px">
]

.pull-right[
<img src="fig/sig_cholera.png" height="450" />
]

---

## Historique

**Le concept de Système d'Information Géographique s'est développé et a évolué avec le développement de l'informatique**. 

- **1950 – 1970** : début de l’informatique, premières cartographies automatiques.

- **1970 - 1980** : diffusion des outils de cartographie automatique/SIG dans les organismes d’État (armée, cadastre, services topographiques…

- **1980 - 1990** : croissance du marché des logiciels SIG, développement des applications SIG.

- **Depuis les années 90 et 2000** : diffusion de SIG plus légers, libres, d'applications web et banalisation de l’usage de l’information géographique (cartographie en ligne, calcul d’itinéraires, utilisation de la géolocalisation, base de données participatives.

.medium[
**Les SIG sont aujourd’hui utilisés dans de nombreux domaines** : 
*Agriculture, aménagement du territoire, architecture, assurances & banque, automobile, BTP, cadastre, découpage électoral, défense, démographie, eau et assainissement, électricité, enseignement, environnement, épidémiologie, équipement, géologie, géomarketing, gestion de flotte, gestion de patrimoine, gestion de réseaux, gestion des sols, Internet, immobilier, implantation de commerces, ingénierie logistique, optimisation de parcours, pétrole et gaz, publicité, recherche, ressources naturelles, santé, services d'urgence, télécommunications, tourisme,...* ]

---

## Définition

**Système informatique de matériels, de logiciels, et de processus conçus pour permettre la collecte, la gestion, la manipulation, l'analyse, la modélisation et l'affichage de données à référence spatiale** afin de résoudre des problèmes complexes d'aménagement et de gestion. (*Comité fédéral de coordination inter-agences pour la cartographie numérique, 1988*)</p> 

.pull-left[
La pratique des logiciels de SIG est un métier : **sigiste**. 

Le SIG est également **l'outil de référence des géomaticiens**. 

La géomatique est une discipline issue de la géographie et des développements de l'informatique (**GEO**graphie + infor**MATIQUE**). 

La géomatique regroupe l'ensemble des outils et méthodes permettant d'acquérir, de représenter, d'analyser et d'intégrer des données géographiques.
]

.pull-right[
![](fig/georezo.png)
]

---

## Principes et fonctionnalités

Les logiciels SIG permettent de **superposer des couches géographiques de différentes natures, dans un même système de projection**. Cela permet de réaliser de puissantes **analyses croisées**.

.pull-left[
<br><br><br>
Ces logiciels permettent d'opérer sur l'intégralité de la chaîne de traitement des données géographiques :

- **Digitalisation** (Saisir et abstraire)  
- **Stockage** et **gestion** (Base de données)    
- **Analyse** (Géotraitements, analyse spatiale)       
- **Représentation** (Cartographie)   
]

.pull-right[
<img src="fig/multi_couche.jpg" height="450" />
]

---

## Principes et fonctionnalités

.pull-left[
<br><br><br>
Pour **modéliser la réalité**, on superpose plusieurs couches d'information géographique, **vecteur et/ou raster**.

Chaque **couche géographique contient des objets de même type** (adresses, parcelles, routes, bâtiments, cours d'eau, limites administratives...)

**Une couche géographique = un type d'objet géographique** : point, ligne, polygone ou image géoréférencée (raster).
]

.center[
.pull-right[
<img src="fig/GIS_SPAIN.jpg" height="450" />
]]

---

## Principes et fonctionnalités

Un SIG permet de travailler sur les trois composantes de l'information géographique :

.pull-left[
.medium[
### Niveau sémantique
**Les attributs** qui décrivent les objets géographiques (ex : libellé, population, catégorie) **peuvent être modifiés, supprimés, ajoutés et surtout requêtés** : Il est possible de sélectionner des objets géographiques **en fonction de la valeur des attributs**.

### Niveau géométrique
Possibilité de **modifier la localisation** et/ou **la forme** des objets géographiques, de **calculer des surfaces**, **des distances**, ou encore des **zones tampons**, de **convertir des polygones en point**... Les opérations possibles sur la géométrie des objets sont multiples.
]
]

.pull-right[
.medium[
### Niveau topologique
Une fonctionnalité puissante qui consiste à **requêter des objets par localisation**, c'est à dire **en fonction de leur positionnement par rapport à d'autres objets**. Pour cela on peut utiliser une série d'opérateur, exemple : *Contient*, *Croise*, *Intersecte*, *Est à l’intérieur*...]

.center[
![](fig/GIS_by_loc.gif)

.small[
Ex : *Sélection d'objets géographiques ponctuels situés à une certaine distance (euclidienne) d'autres objets géographiques ponctuels*
]]]


---

## Les outils : Logiciels d'analyse de données

Les logiciels d'analyse de données (R, SAS, SPSS, etc.) permettent de traiter, explorer et analyser les données disposant d'une dimension géographique, grâce à du code et des fonctions.


```{r, echo = FALSE, out.width = "590px", fig.align='center'}
knitr::include_graphics('fig/rstudio.png')
```

---


## Les outils :  Systèmes d'Informations Géographiques (SIG)

Les SIG sont l'ensemble des outils informatiques permettant de **collecter, stocker, gérer, manipuler, analyser, modéliser et représenter de l’information géographique**. 

.center[
<img src="fig/logiciels.PNG" height="500" />

]

---

## Les outils :  Logiciels de cartographie thématique

Bien que les SIG permettent la réalisation de représentations cartographiques, il ne s'agit pas de leur principale fonctionnalité et réaliser une carte peut s'avérer fastidieux... Si l'on souhaite rapidement réaliser une carte qui respecte l'ensemble des règles de la cartographie, **il est plus simple d'utiliser un logiciel spécialisé**.


```{r, echo = FALSE, out.width = "500px",fig.align='center'}
knitr::include_graphics('fig/Magrit.png')
```

---

## Ouvrir QGIS

**Lancez l'application QGIS Desktop**, comme vous le feriez avec n'importe quel logiciel :

<br><br>
.center[
<img src="fig/logo_qgis.PNG" width="520" />
]

---

## Organiser son projet

L'utilisation d'un SIG nécessite de la **rigueur méthodologique**, car l'on se retrouve vite submergé de fichiers. Vous devez veiller à :

.left-column[
<img src="fig/orgaprojet.png" height="200" />
]

.right-column[

- Travailler en **projet** (projet / enregistrer), à la racine du dossier contenant les données : .qgz ou .qmd dans QGIS. Un projet préserve l'ordre d'apparition des couches géographiques chargées dans le projet et leur style graphique associé. 

- Utiliser des **intitulés de fichiers** intelligibles.

- Ordonner votre travail en utilisant des **sous-répertoires**.
   * **GEOM** : les données géographiques d'entrée, à ne pas modifier.
   * **STAT** : les données statistiques d'entrée, à ne pas modifier.
   * **tmp** : les traitements intermédiaires.  
   * **criteres** : les couches géographiques consolidées du projet. 
   * **fig** : Un dossier dédié à l'export des images et figures issues de votre projet.   
   
- Ne pas modifier les noms des couches géographiques et des répertoires de travail en cours de projet pour ne pas altérer le fichier projet.

]


---
.left-column[
## L'Interface de QGIS

.medium[
1.  **Menu principal**

2.  **La barre d’outils** : Raccourci vers les outils les plus récurrents utilisés

3.  **Barre d’outils latérale** : Par défaut, raccourci vers les options d'import de données.

4.  **La barre d’état** : Niveau de zoom, échelle, coordonnées géographiques

5.  **Les panneaux** : Explorateur, listing des couches géographiques chargées...

6.  **Le canevas de carte** : visualisation des couches géographiques.  
]
]

.right-column[
![](fig/interface_qgis.png)

]

---

.left-column[
## Importer une couche vectorielle

**Pour importer des données**, utilisez la barre d'outil latérale ou la barre d'outils supérieure.

Choisissez l'icône **en fonction du type de données à importer** (vecteur, raster, csv...).

Ces couches sont contenues dans le dossier **GEOM** 
]

.right-column[
![](fig/proj/intro_1_ajout_vecteur.PNG)

.center[
Importez la couche **COMMUNES_METRO_LILLE.shp** et **IRIS_METRO_LILLE.shp** 
]
]

---

.left-column[
## Importer une couche vectorielle

**Pour importer des données**, utilisez la barre d'outil latérale ou la barre d'outils supérieure.

Choisissez l'icône **en fonction du type de données à importer** (vecteur, raster, csv...).

Ces couches sont contenues dans le dossier **GEOM** 
]

.right-column[
![](fig/proj/intro_2.PNG)

.center[
Importez la couche **COMMUNES_METRO_LILLE.shp** et **IRIS_METRO_LILLE.shp** 
]
]


---
.left-column[
## Sélection sur le canevas de la carte

Cette option permet de sélectionner directement sur la carte des objets géographiques

<img src="fig/proj/intro_3_selec.PNG" height="200" />

]

.right-column[
![](fig/proj/intro_3_selec2.PNG)
]

---

.left-column[
## Sélection par attributs

Il est possible de sélectionner les objets géographiques à partir de leur **table attributaire**

1. Clic droit sur la couche IRIS
2. Ouvrir la table d'attributs

]

.right-column[
![](fig/proj/intro_4.PNG)
.center[
Clic droit sur la couche > Ouvrir la Table d'Attributs
]
]

---

.left-column[
## Sélection par attributs

Il est possible de sélectionner les objets géographiques à partir de leur **table attributaire**

1. Clic droit sur la couche IRIS
2. Ouvrir la table d'attributs
3. Ordonner par nom de commune
]


.right-column[
![](fig/proj/intro_5_selec_attr.PNG)
.center[
Sélectionnez les IRIS de **Lille**
]
]


---
## Export d'une sélection

.pull-left[

Clic droit sur IRIS > Exporter > Sauvegarder les entités sélectionnées sous...  

Enregistrer la sélection que vous appelerez *lille_iris* dans le dossier "tmp" au format *geojson*. 

Supprimer ensuite cette couche de la liste des couches (clic droit sur la couche > supprimer la couche)

]

.pull-right[
![](fig/proj/intro_5_selec_attr2.PNG)
]


---
.left-column[
## Gestion de l'affichage graphique

Pour changer l'ordre d'affichage des couches, il suffit de les faire glisser à la position de son choix, comme des onglets dans un navigateur Web.

Le **style graphique d'une couche** (couleur/transparence du fond et de la bordure, épaisseur de bordure, etc.), est paramétrable dans ses propriétés (symbologie) 

]

.right-column[

![](fig/proj/intro_6_styles.PNG)

.center[
clic droit sur une des couches géographiques chargées > Propriétés > Symbologie.

]
]

---

.left-column[
## Gestion de l'affichage graphique

Pour changer l'ordre d'affichage des couches, il suffit de les faire glisser à la position de son choix, comme des onglets dans un navigateur Web.

Le **style graphique d'une couche** (couleur/transparence du fond et de la bordure, épaisseur de bordure, etc.), est paramétrable dans ses propriétés (symbologie) 

]

.right-column[

![](fig/proj/intro_6_styles2.PNG)

.center[
Jouez sur le **style graphique** des couches IRIS et COMMUNES pour les visualiser correctement (jouer sur la transparence et la couleur du trait)

]
]

---
.left-column[
## Gestion de l'affichage graphique

Des **labels (étiquettes)** peuvent faciliter le repérage / la lecture de la carte.

]

.right-column[
.center[
![](fig/proj/intro_7_etiquette.PNG)

Clic-droit sur la couche COMMUNES, puis propriétés. Cliquez ensuite sur "étiquettes".

]
]

---

.left-column[
## Gestion de l'affichage graphique

Des **labels (étiquettes)** peuvent faciliter le repérage / la lecture de la carte.

]

.right-column[
.center[
![](fig/proj/intro_8_etiquette.PNG)

Faites apparaître sur l'espace d'affichage **le nom des communes** de votre espace d'étude.
]
]

---

## Exportez une image, enregistrez votre projet

.left-column[
<img src="fig/export.PNG" height="300" />
]

.right-column[
**Vous pouvez exporter le visuel créé au format .png**. 
Attention néanmoins, il **manque beaucoup d'éléments** (titre, légende, sources...) etc. pour que cette carte soit valable ! Nous verrons cela dans les prochaines séances. Cela peut néanmoins constituer une base de travail et de réflexion. 

**Enregistrez votre projet à la racine de votre dossier de travail**. Les couches que vous avec chargé et leur style associé seront ainsi enregistrées pour la prochaine utilisation 
]

---

class: inverse middle center

#  Systèmes de coordonnées de référence, projections

Qu'est-ce qu'une projection

Gérer la projection de ses couches géographiques dans QGIS


---
class: left middle

## Le géoïde terrestre

**La Terre n'est pas une sphère** qui est une forme géométrie dite parfaite. **Elle est légèrement aplatie aux pôles et bosselée selon les continents**. Son apparence sphérique lorsqu'on l'observe depuis l'espace masque les nombreuses petites irrégularités de sa surface.

Toute mesure ayant besoin d'une référence, on modélise la forme de la Terre selon le modèle théorique du **géoïde**.

.pull-left[
```{r, echo = FALSE, out.width = "350px", fig.align='center'}
knitr::include_graphics('fig/geoide.png')
```
]

.pull-right[

.medium[
<br><br>
Un géoïde est une surface équipotentielle du champ de pesanteur coïncidant « au mieux » avec le **niveau moyen des océans et qui se prolonge sous les continents**.
 
**La surface du géoïde équivaut au niveau d'altitude 0** à l'échelle mondiale. La notion d'**altitude traduit donc la hauteur au-dessus du géoïde**.

Pour la France, il est calé sur un niveau zéro scellé dans le port de Marseille.
]
]

---

##  Formalisation mathématique du géoïde

.pull-left[

<br><br><br>
Le géoïde est une **surface difforme** à laquelle on ne saurait appliquer des **relations mathématiques**.

Pour modéliser cette surface, on utilise une **figure géométrique régulière**: **l'ellipsoïde**.      

Il s'agit d'un volume globalement sphérique présentant un aplatissement aux pôles.
]

.pull-right[

```{r, echo = FALSE, out.width = "300px", fig.align='center'}
knitr::include_graphics('fig/globe.gif')
```

<br>

```{r, echo = FALSE, out.width = "300px", fig.align='center'}
knitr::include_graphics('fig/AnimationSphere2.GIF')
```
]

---

## L'ellipsoïde terrestre

**L'ellipsoïde est la surface mathématique qui se rapproche le plus du géoïde**. 

Il sert de **référence pour la construction des projections cartographiques**. Positionner l'ellipsoïde en fonction du géoïde permet de construire **un système géodésique**.

.pull-left[
```{r, echo = FALSE, out.width = "500px", fig.align='center'}
knitr::include_graphics('fig/geoide_ellips.png')
```
]

.pull-right[
```{r, echo = FALSE, out.width = "400px", fig.align='center'}
knitr::include_graphics('fig/ellipsoid.jpg')
```
]

---

## Ecart ellipsoïde-géoïde

.pull-left[
```{r, echo = FALSE, out.width = "500px", fig.align='center'}
knitr::include_graphics('fig/geoide.png')
```

]

.pull-right[
.medium[
<br><br>

**Les couleurs traduisent l'écart entre le géoïde et l'ellipsoïde**. Cela se nomme la 'hauteur', et **ne dépasse pas 110 mètres** ! 

Si la forme de la terre n'est pas régulière, elle se rapproche donc fortement d'un ellipsoïde

Il est important de noter que **l'altitude** d'un point est calculé par rapport à son l'**éloignement vertical à la surface du géoïde** et **pas à celle de l’ellipsoïde de référence**.
]
]

---

## Les systèmes géodésiques

**Un système géodésique** sert de repère pour déterminer les coordonnées géographiques (ou géodésiques) d'un objet à la surface de la Terre. 

.pull-left[
```{r, echo = FALSE, out.width = "300px", fig.align='center'}
knitr::include_graphics('fig/meridien_paral.gif')
```
]

.pull-right[
```{r, echo = FALSE, out.width = "300px", fig.align='center'}
knitr::include_graphics('fig/sphere_lat_long.png')
```
]

**Ces coordonnées sont des valeurs angulaires, calculées par rapport à un parallèle (équateur) et un méridien de référence (Greenwich)**. Les coordonnées d'un objet traduit (au minimum) deux dimensions : **la latitude et la longitude = des angles**.

---

## Les systèmes géodésiques à connaître

Un même **ellipsoïde peut être positionné différemment par rapport au géoïde**, et ainsi constituer des systèmes de référence géodésiques **différents**. Le même objet n'aura pas les mêmes coordonnées géographiques dans différents systèmes géodésiques.

- **WSG84 (World Geodesic System 1984)**  
*Le plus utilisé au monde. C'est ce système géodésique qui est utilisé pour le GPS (système de positionnement par satellites).*

- **ITRS (International Terrestrial Reference System)**  
*Le plus précis à l'échelle mondiale (précision centimétrique).* 

- **RGF93 (Réseau Géodésique Français 1993)**.  
*Système géodésique officiel en France métropolitaine.*

- **NTF (Nouvelle Triangulation de la France)**
*Ancien système géodésique français de référence, couvrant le territoire métropolitain.*

---

## Les projections cartographiques

.center[
**Un système géodésique permet de localiser un objet sur une surface en 3 dimensions**    

```{r, echo = FALSE, out.width = "800px", fig.align='center'}
knitr::include_graphics('fig/orange.png')
```

*Mais comment représenter l'information géographique sur un plan en deux dimensions, sur une carte ?*]
---

## Les projections cartographiques

Une **projection est un procédé mathématique permettant de passer de l'ellipsoïde à sa représentation sur une surface plane**. 

Toutes les projections provoquent des déformations. Plus l'espace représenté est vaste, plus les altérations sont importantes.


```{r, echo = FALSE, out.width = "800px", fig.align='center'}
knitr::include_graphics('fig/projection_style.jpeg')
```

Les projections cartographiques peuvent se classer **selon le type d'altération et la surface de projection**. 

---

## Surfaces de projection

Un ellipsoïde **peut être projeté sur différentes surfaces**, facilement **représentables en deux dimensions**.

.pull-left[
<img src="fig/surface_proj.png" height="450" />
]

.pull-right[
.medium[
Le cône, le cylindre et le plan sont des formes géométriques développables. 

Dans la **projection conique** les méridiens et les parallèles sont projetés sur un cône qui est tangent avec le parallèle souhaité. Cette projection permet d'établir des cartes assez fidèles à la réalité dans les régions voisines du parallèle de contact. Par contre les régions éloignées sont très déformées et souvent un des deux hémisphères ne peut être cartographié en même temps que l'autre.

Une **projection cylindrique** est la projection de la Terre sur un cylindre tangent à un grand cercle ou sécant en deux cercles. Lorsque la sphère est projetée sur un seul cylindre, il y a une importante distorsion des hautes latitudes, où les surfaces sont considérablement agrandies.

Une **projection azimutale** est une manière de projeter une sphère sur un plan, et en particulier, une façon de représenter entièrement la surface de la Terre sous la forme d'un disque.

]
]

---

## Surfaces de projection

Un ellipsoïde **peut être projeté sur différentes surfaces**, facilement **représentable en deux dimensions**.

.pull-left[
<img src="fig/surface_proj_2.png" height="350" />
]


.pull-right[
.medium[
<br><br><br>

Pour un plan **tangent**, le cône, le cylindre ou le plan ne touchent la Terre que le long d'une seule droite ou qu'à un point. 

Dans le cas d'un **plan sécant**, le cône ou le cylindre coupent au travers de la Terre au moyen de deux cercles. 

Le lieu du point de contact définit l'endroit où les distorsions sont les moins importantes. Il est appelé **parallèle de référence**

Les projections planes peuvent être orientées de différentes manières : **polaire (directe)**, **équatoriale (transverse)** et **oblique**.
]
]

---

## Le choix du centrage : pas de règle, mais le résultat n'est pas anodin !

.pull-left[
<img src="fig/US.jpg" width="500" />
<img src="fig/ONU.png" width="500" />
]

.pull-right[
<img src="fig/chinese_world.jpeg" width="500" />
<img src="fig/australian.jpg" width="500" />
]

---

## Les types de projection (déformations)

Les projections peuvent être classées selon les **altérations géométriques** qu'elles provoquent.

.pull-left[

### Projections conformes

**Conservent localement les angles, donc les formes**. Les méridiens et parallèles se coupent à angle droit.    

**Les surfaces et les distances sont déformées.** Ce type de projection peut être utilisé pour la navigation maritime.
]

.pull-right[
```{r, echo = FALSE, out.width = "480px", fig.align='center'}
knitr::include_graphics('fig/mercator.jpg')
```
.medium[Exemple : **Projection Mercator**]
.small[*Gerardus Mercator (1569)*]

]

---

## Les types de projection (déformations)

Les projections peuvent être classées selon les **altérations géométriques** qu'elles provoquent.

.pull-left[

### Projections équivalentes

**Conserve localement les surfaces**, mais au prix d’une **déformation des distances et des angles** de route sur la carte.] 

.pull-right[
```{r, echo = FALSE, out.width = "520px", fig.align='center'}
knitr::include_graphics('fig/gall_peters.jpg')
```
.medium[Exemple : **Projection Gall–Peters**]
.small[*James Gall et Arno Peters (1855)*]

]

---
## Les types de projection (déformations)

Les projections peuvent être classées selon les **altérations géométriques** qu'elles provoquent.

.pull-left[

### Projections aphylactiques

Projections  **ni conformes, ni équivalentes**, mais qui cherchent à faire un **compromis acceptable** entre les inévitables déformations des surfaces, des distances et des angles sur une carte.
]

.pull-right[
```{r, echo = FALSE, out.width = "550px", fig.align='center'}
knitr::include_graphics('fig/Natural_Earth.JPG')
```
.medium[Exemple : **Projection Natural Earth**]
.small[*Tom Patterson (2011)*]
]

---
## Les types de projection (déformations)

Les projections peuvent être classées selon les **altérations géométriques** qu'elles provoquent.

.pull-left[

### Projections aphylactiques (équidistantes)

La **distance et la direction**, mesurées à partir du point central, sont toutes deux exactes.] 


.pull-right[
```{r, echo = FALSE, out.width = "380px", fig.align='center'}
knitr::include_graphics('fig/postel.png')
```
.medium[Exemple : **Projection Postel**]
.small[*Al-Biruni (1000 envir.)*]
]


---

## Quelles déformations ? 

Le cas controversé de la projection Mercator... 

.pull-left[
```{r, echo = FALSE, out.width = "500px", fig.align='center'}
knitr::include_graphics('fig/russie_afrique.png')
```
.medium[En réalité, la Russie est 2 fois moins étendue que l'Afrique...]
]

.pull-right[
```{r, echo = FALSE, out.width = "500px", fig.align='center'}
knitr::include_graphics('fig/SA_groenland.png')
```
.medium[... Et l'Amérique du Sud 8 fois plus étendue que le Groenland !]
]


---

## Quelles déformations ? 

```{r, echo = FALSE, out.width = "800px", fig.align='center'}
knitr::include_graphics('fig/truesize.PNG')
```

.center[
.medium[*https://thetruesize.com*]
]


---

## Quelles déformations ? 

**L'indicatrice de Tissot** permet d'apprécier les déformations engendrées par l'usage d'un système de projection cartographique.

.pull-left[
```{r, echo = FALSE, out.width = "450x", fig.align='center'}
knitr::include_graphics('fig/mercator_deform.png')
```
]

.pull-right[
```{r, echo = FALSE, out.width = "500px", fig.align='center'}
knitr::include_graphics('fig/equivalente_deform.png')
```

<br>
Une forme géométrique (un cercle ou une ellipse) est répétée de manière régulière sur le planisphère.
]

---

## Quelle projection choisir ? Des normes, des références et des choix

**Le choix d'une projection cartographique** ne se fait pas aléatoirement.

-  En France, tout comme dans de nombreux pays, vous êtes soumis à des **normes** si vous travaillez dans le cadre d'une **mission de service public.**

-  Sinon, **c'est la zone représentée, la thématique et l'objectif de la carte** qui vous permettront de choisir une projection.
.medium[
* Pour la navigation, les directions sont importantes.
* Sur les cartes routières, les distances précises sont importantes. 
<br><br>
** Des conventions pour certaines zones géographiques :**
* Pour les régions de basse latitude (près de l'Équateur), utilisez des projections cylindriques.
* Pour les régions de latitude moyenne, les projections coniques sont plus adaptées.
* Pour les régions polaires, plutôt des projections azimutales.
]

D'un point de vue général, ne pas oublier que plus la surface à représenter est importante, plus les distorsions le seront également
---

## En France : La projection Lambert93

.pull-left[
Suite à un décret du [3 mars 2006](https://geodesie.ign.fr/contenu/fichiers/Decret2006-272_03-03-06MODdecret2000-1276.pdf) :

.medium[
Toutes les administrations de l'État, collectivités locales et entreprises chargées de l'exécution d'une mission de service public doivent utiliser le **système géodésique de référence RGF93** pour leurs échanges de données géoréférencées.

Ce système géodésique est compatible avec le système géodésique de **référence européen ETRS89** et avec le système géodésique de référence mondial **WGS84** (utilisé par le système GPS).

Les cartes officielles représentant l'ensemble de la France métropolitaine doivent utiliser la projection de référence **Lambert93 Conique Conforme**. 9 variantes de cette projection existent, elles couvrent 9 zones s'étalant du Nord au Sud et doivent être utilisées pour la cartographie locale.]

.leg-fig[
[Source : Géoréférencement et RGF93, théorie et concepts, 2008](http://gtsoft.ftpacs.com/RGF93_theorie_et_concept_T3.pdf?PHPSESSID=649823751d32b07817a3795a95f748aa)]
]

.pull-right[

<img src="fig/france_ref.png" width="550" />
]

---

## Chaque pays a son popre système de projection de référence ! 

L'EPSG (European Petroleum Survey Group) a construit en place une base de données qui recense et identifie les systèmes de **coordonnées géographiques de projection les plus utilisés**.

.center[
[**epsg.io**](https://epsg.io/) est aujourd'hui une ressource Open-Source de référence internationale.
]

```{r, echo = FALSE, out.width = "800px", fig.align='center'}
knitr::include_graphics('fig/epsg1.PNG')
```

.medium[
Les **codes EPSG** sont des identifiants uniques pour qualifier de systèmes de projection, directement utilisables dans des SIG.
]
---

.left-column[
## Consulter le Systèmes de Coordonnées de référence (SCR) d'une couche

Si les couches géographiques de votre projet ne sont pas dans le même système de coordonnées de référence, vous exposez vos manipulations à de nombreux désagréments ! 

**La projection** d'une couche géographique **est indiquée dans ses propriétés générales**.

Importez les couches géographiques des gymnases et des écoles élémentaires de la MEL.

]

.right-column[
![](fig/proj/projection_1.PNG)
.center[
Importez les couches géographiques *LILLE_ECOLE.shp* et *gym_osm.shp*. Consulter leur SCR (Clic droit sur la couche > Propriétés > Informations).
]
]

---
.left-column[
## Modifier le SCR d'une couche géographique
Les couches géographiques s'affichent automatiquement dans le système de projection de la première couche géographique importée.

Pour modifier le système de projection, il suffit d'enregistrer une nouvelle version de la couche géographique concernée dans le système de projection souhaité (clic-droit sur la couche, enregistrez-sous...).

]

.right-column[

![](fig/proj/projection_2.PNG)

Exportez les couches géographiques des écoles et gymnases dans le même SCR que celui des IRIS et communes (Lambert 93). Enregistrez ces couches dans votre dossier *tmp*, puis nettoyer l'espace de travail (éviter de visualiser des couches géographiques dorénavant inutiles)

]


---

class: inverse middle center

#  Manipulations de base (vecteur)

Sélections attributaires

Import de données tabulaires

Jointure attributaire

Jointure spatiale

---

## Sélection par attributs

.pull-left[
Il s'agit d'une sélection portant sur les **caractéristiques non spatiales des entités**. Dans un SIG, elles sont prises en charge dans la table attributaire des couches géographiques.

On peut effectuer une sélection par expression sur des **variables catégorielles/qualitatives** *(ex : IRIS de de la commune "Bagnolet")* ou sur des **variables quantitatives** *(ex: IRIS dont le nombre de foyers fiscaux est supérieur à "10000")*

Le SIG renverra alors une sélection des entités dont les valeurs répondent à la requête
]

.pull-right[
<img src="fig/select_expression.PNG" width="450" />
]

---
## Sélection par localisation

.pull-left[
<br><br><br><br>
La sélection par localisation permet de sélectionner certaines entités d'une couche au regard de leur positionnement géographique vis-à-vis d'une autre couche géographique.

Le choix du **prédicat géométrique est important** (intersecte, contient, est disjoint, égal, touche, chevauche, à l'intérieur, croise, etc.) 
]

.pull-right[
<img src="fig/selection_localisation.jpg" width="450" />
.leg-fig[Source : École nationale des techniciens de l'équipement. Établissement d'Aix-en-Provence
]
]

---
class: middle

.pull-left[
## Premier critère : Un lieu de pratique adapté

### Nouvelles notions SIG : Sélection par localisation et sélection par expression. 

Objectifs d'atelier :

 - Extraire les gymnases où l'on pratique actuellement du roller.
 - Ne sélectionner que les gymnases incclus dans la MEL
 - Sélectionner les gymnase de type "multi-activité"
 - Sélectionner les gymnases d'une surface au moins 2 fois supérieure à l'emprise d'une piste de roller-derby (750 m²)


]

.pull-right[
![](fig/Roller_derby_track.svg.png)

]

---

## Quelle pratique actuelle ? 

.left-column[

### Sélectionner les gymnases où une pratique du roller est recensée

.medium[
Clic droit sur la couche *gymnase* > ouvrir la table attributaire > sélection par expression

]
]

.right-column[
.center[
<img src="fig/proj/crit_0_selec_expression.PNG" width="500" />
<img src="fig/proj/crit3_1_roller_gym.PNG" width="700" />
]
]

---

## Quelle pratique actuelle ? 

.left-column[

### Sélectionner les gymnases où une pratique du roller est recensée

.medium[
Sur les 324 gymnases de la couches géographiques initiale, 6 ont une pratique identifiée du roller. 

Enregistrer cette sélection sous le nom ***roller*** dans votre dossier ***tmp***.
]
]

.right-column[
.center[
<img src="fig/proj/crit3_2_selec.png" width="700" />

]
]
---

## Un lieu de pratique adapté

.left-column[

### ***Étape 1*** - Sélectionner les gymnases inclus dans la MEL

On ne recherche pas à pratiquer l'activité en Belgique ! 

.medium[
Vecteur > Outil de recherche > Sélection par localisation. 

Sur les 324 gymnases de la couches géographiques initiale, seuls 265 sont inclus dans la MEL. 

Enregistrer cette sélection sous le nom ***gymnase_MEL*** dans votre dossier ***tmp***.

Nettoyez votre espace de travail, ne conserver que la couche *gymnase_MEL* et la couche *communes*. 
]

]

.right-column[
.center[
<img src="fig/proj/crit1_0_selec_localisation.PNG" width="700" />
]
]

---

## Un lieu de pratique adapté

.left-column[

### ***Étape 2*** - Sélectionner les gymnases permettant des multi-activités

Tous les gymnases ne se prêtent pas au roller-derby (tennis, terrains de boule, etc). 
On ne conserve que les gymnase qui accueillent des multi-activités (multi). 

.medium[

Clic droit sur la couche ***gymnase_MEL*** > ouvrir la table attributaire > sélection par expression
]
]

.right-column[
.center[
<img src="fig/proj/crit_0_selec_expression.PNG" width="500" />
<img src="fig/proj/crit1_1_gymnase_multi_1.PNG" width="700" />
]
]
---

## Un lieu de pratique adapté

.left-column[

### ***Étape 2*** - Sélectionner les gymnases permettant des multi-activités

Tous les gymnases ne se prêtent pas au roller-derby (tennis, terrains de boule, etc). 
On ne conserve que les gymnase qui accueillent des multi-activités (multi). 

.medium[
Sur les 265 gymnases de la MEL, 52 sont connus par accueillir plusieurs activités.  

Enregistrez cette sélection sous le nom *gymnase_MEL_MULTI* dans votre dossier tmp et nettoyez votre espace de travail. 
]

]

.right-column[
.center[
<img src="fig/proj/crit1_2_gymnase_multi_2.PNG" width="700" />
]
]

---

## Un lieu de pratique adapté

.left-column[

### **Étape 3** - Sélectionner les gymnases d'une surface suffisante

On estime qu'au moins 1500m² (2 fois l'emprise d'une piste de roller derby) est nécessaire pour la pratique de l'activité

.medium[
Clic droit sur la couche *gymnase_MEL_MULTI* > ouvrir la table attributaire > sélection par expression
]
]

.right-column[
.center[
<img src="fig/proj/crit1_3_gymnase_area_1500m_sq.PNG" width="700" />
]
]

---

## Un lieu de pratique adapté

.left-column[

### **Étape 3** - Sélectionner les gymnases d'une surface suffisante

On estime qu'au moins 1500m² (2 fois l'emprise d'une piste de roller derby) est nécessaire pour la pratique de l'activité

.medium[
**BRAVO ! VOUS AVEZ IDENTIFIÉ UN PREMIER CRITERE D'IMPLANTATION !!** Sur les 52 gymnases restant , 24 présentent une surface favorable ! 

Enregistrez cette sélection sous le nom ***CRITERE_1_MULTI_1500M_SQ*** dans votre dossier ***criteres*** et nettoyez votre espace de travail. 
]
]

.right-column[
.center[
<img src="fig/proj/crit1_4_gymnase_area_1500m_sq_2.png" width="700" />

]
]


---
## Jointure attributaire

.pull-left[
Une **jointure attributaire** permet de joindre **deux tables attributaires décrivant des entités communes et partageant un champ commun**. L'opération produit **une seule table** juxtaposant les champs de la table à joindre à ceux de la table d'origine.

Dans un SIG la table d'origine est souvent celle associée aux entités localisées d'**une couche géographique**, ce qui permet par exemple de cartographier les **données d'un tableau statistique sans dimension spatiale**. 

Les jointures attributaires sont utilisées lorsque l'on souhaite introduire des informations nouvelles dans une couche géographique.
]

.pull-right[
<br><br><br>
<img src="fig/jointure_attributaire.png" width="450" />

.leg-fig[Source : Université Virtuelle Environnement et Développement durable, glossaire des SIG.
]
]
---

## Jointure spatiale

.pull-left[
<br><br>
Une **jointure spatiale** permet de caractérister le **positionnement relatif d'entités issues de deux couches géographiques différentes**.

Par exemple, une table des écoles pourra être jointe à une table des communes en fonction d'une **relation spatiale de type inclusion géométrique**. 

Si le point de l'école se trouve dans le polygone correspondant à la commune, les attributs de la table commune deviendront des attributs de la table école. Par définition, une jointure ne peut donc être effectuée qu'entre des données géographiques et non des tables attributaires.
]

.pull-right[
<img src="fig/jointure_spatiale_1.png" width="450" />

.leg-fig[
Source : Université Virtuelle Environnement et Développement durable, glossaire des SIG.
]
]

---

class: middle

.pull-left[
## Deuxième critère : Pour une pratique accessible aux moins favorisés

### Nouvelles notions SIG : Import de données tabulaires, jointures attributaires. 

Objectifs d'atelier :

 - Extraire les gymnases où l'on pratique actuellement du roller.
 - Ne sélectionner que les gymnases incclus dans la MEL
 - Sélectionner les gymnase de type "multi-activité"
 - Sélectionner les gymnases d'une surface au moins 2 fois supérieure à l'emprise d'une piste de roller-derby (750 m²)


]

---

## Pour une pratique accessible aux moins favorisés

.left-column[

### **Étape 1** - Transformer le fichier Excel contenant les données en .csv, puis l'importer dans QGIS 

.medium[

Ouvrez le fichier STAT > data_INSEE.xls

L'enregistrer au format .csv

Couche > Ajouter une couche > Ajouter une couche de texte délimité
- Virgule en séparateur décimal
- Pas de géométrie

*Cliquez sur "ajouter"*
]
]

.right-column[
.center[
![](fig/proj/crit2_1_import_insee.PNG)
]
]

---

## Pour une pratique accessible aux moins favorisés
.left-column[

### **Étape 2** - Jointure attributaire

.medium[
Jointure de ce fichier de données non spatiales à la couche géographique des IRIS.

Au préalable, il faut s'assurer de la concordance des données statistiques avec les géométries et identifier le nom de la colonne (identifiant unique) sur laquelle portera la jointure.

Clic droit sur la couche ***IRIS_METRO_LILLE***, propriétés, jointure, cliquez sur "+"*
]
]

.right-column[
.center[
![](fig/proj/crit2_2_jointure1.PNG)
]]

---

## Pour une pratique accessible aux moins favorisés
.left-column[

### **Étape 2** - Jointure attributaire

.medium[
Jointure de ce fichier de données non spatiales à la couche géographique des IRIS.

Au préalable, il faut s'assurer de la concordance des données statistiques avec les géométries et identifier le nom de la colonne (identifiant unique) sur laquelle portera la jointure.

*Choisir les deux champs à mettre en lien N'hésitez pas à jeter un oeil aux tables attributaires et aux métadonnées pour vous aider à cibler les bons identifiants.*
]
]

.right-column[
.center[
![](fig/proj/crit2_3_jointure2.PNG)
]]

---

## Pour une pratique accessible aux moins favorisés
.left-column[

### **Étape 2** - Jointure attributaire

.medium[
Jointure de ce fichier de données non spatiales à la couche géographique des IRIS.

Au préalable, il faut s'assurer de la concordance des données statistiques avec les géométries et identifier le nom de la colonne (identifiant unique) sur laquelle portera la jointure.

*Choisir les deux champs à mettre en lien N'hésitez pas à jeter un oeil aux tables attributaires et aux métadonnées pour vous aider à cibler les bons identifiants.*
]
]

.right-column[
.center[
**BRAVO !!! Vous venez de joindre les données démographiques de l'INSEE dans la table attributaire de la couche IGN IRIS !** 
![](fig/proj/crit2_4_verif_jointure.PNG)
]]

---

## Pour une pratique accessible aux moins favorisés
.left-column[

### **Étape 3** - Statistiques basiques

QGIS propose plusieurs outils permettant de retourner des statistiques basiques sur les données attributaires d'une couche géographique.

.medium[
Ouvrez le module de statistiques basiques et effectuez l'opération pour le champ ***DEC_MED_19***
]
]

.right-column[
.center[
![](fig/proj/crit2_5_stat_basique.PNG)
![](fig/proj/crit2_6_stat_basique_2.PNG)
]]

---

## Pour une pratique accessible aux moins favorisés
.left-column[

### **Étape 3** - Statistiques basiques

QGIS propose plusieurs outils permettant de retourner des statistiques basiques sur les données attributaires d'une couche géographique.

.medium[
La moyenne du revenu médian des IRIS qui composent la MEL s'élève à 20 625 euros. Nous retenons cette valeur en tête... 
]
]

.right-column[
.center[
![](fig/proj/crit2_7_stat_basique_3.PNG)
]]



---


## Pour une pratique accessible aux moins favorisés
.left-column[

### **Étape 4** - Sélection par attributs


.medium[
Sélectionner les IRIS sous la moyenne de la MEL au moyen d'une sélection par expression...
]
]

.right-column[
.center[
![](fig/proj/crit2_8_selec_rev_mean.PNG)
]]



---


## Pour une pratique accessible aux moins favorisés
.left-column[

### **Étape 4** - Sélection par attributs


.medium[
Sélectionner les IRIS sous la moyenne de la MEL au moyen d'une sélection par expression...

... puis enregistrer la sélection sous le nom ***CRITERE_2_REVENU*** de votre dossier ***criteres***. 
]
]

.right-column[
.center[
![](fig/proj/crit2_9_result_selec.PNG)
]]


---

class: inverse middle center

#  Géotraitements et introductions aux statistiques spatiales

---

## Géotraitement

.pull-left[

Les SIG proposent plusieurs outils de **géotraitement**. Ils permettent d'opérer sur la **géométrie et/ou la topologie** des objets géographiques. La dimension attributaire est parfois également prise en compte. Ces traitements peuvent s'effectuer en mode **vecteur** et/ou en mode **raster**.

Le résultat d'un géotraitement est la **création d'une nouvelle couche géographique**.

<img src="fig/geotraitement1.PNG" width="390" />
.leg-fig[
Extrusion des contours des côtes bretonnes par une série de géotraitements (Source : [Atol Open Blog](https://blog.atolcd.com/mise-a-jour-en-vue-pour-lextension-gis-de-pentaho-data-integration/))
]

]

.pull-right[

<img src="fig/geotraitement2.PNG" width="390" />

.leg-fig[
Tampons variables autour des rivières (Source : [Documentation QGIS](https://docs.qgis.org/2.8/fr/docs/gentle_gis_introduction/vector_spatial_analysis_buffers.html))]
]

---


## Géotraitement

.pull-left[

Les SIG proposent plusieurs outils de **géotraitement**. Ils permettent d'opérer sur la **géométrie et/ou la topologie** des objets géographiques. La dimension attributaire est parfois également prise en compte. Ces traitements peuvent s'effectuer en mode **vecteur** et/ou en mode **raster**.

Le résultat d'un géotraitement est la **création d'une nouvelle couche géographique**.

<img src="fig/geotraitement1.PNG" width="390" />
.leg-fig[
Extrusion des contours des côtes bretonnes par une série de géotraitements (Source : [Atol Open Blog](https://blog.atolcd.com/mise-a-jour-en-vue-pour-lextension-gis-de-pentaho-data-integration/))
]

]

.pull-right[

<img src="fig/buffer_lille.PNG" width="500" />

.leg-fig[
Périmètre de 500 m autour des monuments historiques avec interdiction relative de publicité (Source : [Open Data Métropole Européenne de Lille](https://opendata.lillemetropole.fr/explore/dataset/zone-de-500m-autour-des-monuments-historiques-spr/information/?location=12,50.65871,3.11617&basemap=jawg.streets))]
]


---
.pull-left[

### Zone tampon (buffer, distances tampon)

.center[
<img src="fig/tampon.PNG" width="400" />
]

--
### Intersection

.center[
<img src="fig/intersection.PNG" width="400" />
]
]

--
.pull-right[
### Différenciation symétrique (ou différence)

.center[
<img src="fig/differenciation.PNG" width="400" />
]

--

## Union

.center[
<img src="fig/union.PNG" width="400" />
]
]

---

## Regroupement (merge, dissolve)

.center[
<img src="fig/merge.PNG" width="400" />
]

---

class: middle

.pull-left[
## Troisième critère : Diversifier l'offre géographique

### Nouvelles notions SIG : Mise en oeuvre de géotraitements

Objectifs d'atelier :

 - Extraire l'espace à plus de 2000 mètre d'un lieu de pratique de roller connu.


]


---

## Diversifier l'offre géographique

.left-column[

### **Étape 1** - Espace tampon de 2000m autour de la couche roller


.medium[
Importez la couche ***roller*** précédemment créée et stockée dans le dossier ***tmp*** puis réalisez un **espace tampon** de **2000 m** autour des polygones qu'elle contient. 

Sélectionnez l'option *regrouper les résultats*. 
]
]

.right-column[
.center[
![](fig/proj/crit3_3_tampon.PNG)
]]


---

## Diversifier l'offre géographique

.left-column[

### **Étape 2** - Différence entre le territoire de la MEL et l'espace tampon précédemment créé


.medium[
Importez la couche ***MEL*** (dossier ***GEOM***), puis réaliser la **différence** entre cette couche et l'**espace mis en tampon** stocké virtuellement sur votre ordinateur. 


]
]

.right-column[
.center[
![](fig/proj/crit3_4_difference.PNG)
]]

---

## Diversifier l'offre géographique

.left-column[

### **Étape 3** - Export du résultat

Nous avons sous les yeux l'espace situé à plus de 2000 mètres d'un gymnase où une pratique connue du roller est inventoriée ! 

.medium[

Exportez la couche ***différence*** (clic droit sur la couche difference, puis exporter) dans le dossier ***criteres***, et nommer la couche ***CRITERE_3_DISTANCE_2000_ROLLER***. 


]
]

.right-column[
.center[
![](fig/proj/crit3_5_result.PNG)
]]

---

## Statistiques spatiales

QGIS offre plusieurs [fonctionnalités](https://docs.qgis.org/2.8/fr/docs/training_manual/vector_analysis/spatial_statistics.html#:~:text=Les%20statistiques%20spatiales%20vous%20permettent,av%C3%A8rent%20utiles%20%C3%A0%20cet%20%C3%A9gard.) qui permettent d'analyser et de comprendre ce qu'il se passe dans un jeu de données vectorielles. 

- **Calculer une matrice de distance** : Calculer des distances entre les points d'une couche géographique et indicateurs dérivés (distance minimale, moyenne, maximale, etc.)

- **Coordonnées moyennes** : Obtenir le centre géométrique d'une couche de polygones.

- **Dénombrement de points dans des polygones** : Le nombre de points inclus dans un polygone. 

... Et beaucoup d'autres !


---


class: middle

.pull-left[
## Quatrième critère : Pour une pratique scolaire

### Nouvelles notions SIG : Compter des points dans un polygone

Objectifs d'atelier :

 - Ne sélectionnez que les gymnases qui ont moins 3 écoles à moins de 1000 mètres

]


---

## Pour une pratique scolaire

.left-column[

### **Étape 1** - Import des couches utiles

.medium[

Nettoyez votre espace de travail (supprimer les couches géographiques inutiles).

Importez la couche ***CRITERE_1_MULTI_1500M_SQ*** précédemment créée (dossier ***criteres***), la couche ***écoles*** correctement projetée (EPSG 2154, dossier ***tmp***)  

Importez la couche de la MEL pour visualiser l'emprise de la métropole également. 

]
]

.right-column[
.center[
![](fig/proj/crit4_1_layers.PNG)
]]


---

## Pour une pratique scolaire

.left-column[

### **Étape 2** - Espace tampon de 1000 mètres autour des gymnases

.medium[

Réaliser un espace tampon de 1000 mètres autour des gymnases **sans regrouper les résultats** 

![](fig/proj/crit4_2_tampon.PNG)

]
]

.right-column[
.center[
![](fig/proj/crit4_3_result.png)
]]

---

## Pour une pratique scolaire

.left-column[

### **Étape 3** - Compter le nombre d'école dans l'espace tampon de 1000 m

.medium[

Vecteur > Outil d'analyse > Compter les points dans les polygones

]
]

.right-column[
.center[
![](fig/proj/crit4_5_count_points.PNG)
]]

---

## Pour une pratique scolaire

.left-column[

### **Étape 4** - Joindre le résultas à la couche des gymnases

.medium[

Clic droit sur la couche ***CRITERE_1_MULTI_1500M_SQ*** > Propriétés > Jointure

Joindre la couche temporaire ***Compte*** par l'identifiant commune (champ ***osm_id***)

]
]

.right-column[
.center[
![](fig/proj/crit4_6_join_result.PNG)
]]

---

## Pour une pratique scolaire

.left-column[

### **Étape 5** - Sélectionner les gymnases avec plus de 3 écoles

.medium[

Clic droit sur la couche ***CRITERE_1_MULTI_1500M_SQ*** > Ouvrir la table d'attributs. 

Ordonner le champ ***NUM_ECOLE*** de façon croissante. 

Sélectionner les gymnases avec plus de 3 écoles. 
]
]

.right-column[
.center[
![](fig/proj/crit4_7_select.PNG)
]]


---

## Pour une pratique scolaire

.left-column[

### **Étape 6** - Exportez les résultats

.medium[

Clic droit sur la couche ***CRITERE_1_MULTI_1500M_SQ*** > N'enregistrer que les entités sélectionnées. 

Enregistrer la sélection dans le dossier ***criteres*** et la nommer ***CRITERE_1_4_3ECOLES_1000M***
]
]

.right-column[
.center[
![](fig/proj/crit4_8_export.PNG)
]]


---
class: inverse middle center

# Mise en cohérence des critères

Modéliser sa chaîne de traitement

Identifier une localisation optimale

---
## Modéliser sa chaine de traitement

La modélisation graphique de la chaîne de traitement, aussi appelée *cheminement décisionnel* est particulièrement utile pour :

- Expliquer **les étapes de la réalisation** à d’autres personnes (reproductibilité des résultats, transposition à d'autres espaces d'études ou objets géographiques).

- Apporter de la **rigueur méthodologique** à ses travaux (transparence de la procédure). 

- Se rappeler comment sont **nommées et organisés les fichiers** (particulièrement utile d’une séance à l’autre).  

Nous vous conseillons de réaliser ce schéma au fur et à mesure de l’avancement de vos traitements ! 

---
## Modéliser sa chaine de traitement

Insérer maj chemin décisionnel

---

## Quelle implantation ? Une possible procédure... 

Nous avons créé 4 couches géographiques qui constituent nos critères pour l'implantation d'une nouvelle piste de roller derby:

- **CRITERE_1_MULTI_1500M_SQ** : Gymnases de plus de 1500 m², multi-activité, localisé dans la MEL.
- **CRITERE_2_REVENU** : Les IRIS dont le revenu médian est inférieur à la moyenne de la MEL.
- **CRITERE_3_DISTANCE_2000_ROLLER** : l'espace à plus de 2000m d'un gymnase avev une activité de roller existante  
- **CRITERE_1_4_3ECOLES_1000M** : A partir du critère 1, les gymnases qui comprennent au moins 3 écoles à moins de 1000 mètres

<br>

Dans notre cas, nous cherchons à identifier les gymnases qui recoupent l'ensemble de ces critères...

---
## Une possible procédure... 

Sélectionnez les gymnases issus du critère 4 qui recoupent les IRIS à plus faible revenu. 

.medium[
Outil de recherche > selection par localisation
]

.pull-left[
![](fig/proj/selec_2.PNG)
]

.pull-right[
![](fig/proj/selec_2.PNG)
]

---
## Une possible procédure... 

Parmi la sélection courante de ces gymnases, sélectionnez les gymnases à plus de 2000 mètres d'un gymnase avec pratique de roller.
Exportez ensuite le résultat de la sélection dans le dossier **criteres** et nommez la couche **IMPLANTATION**


.pull-left[
![](fig/proj/selec_5.PNG)
]

.pull-right[
![](fig/proj/selec_6.PNG)
]


---

## <img src="fig/eureka.PNG" width="60" />        Eureka ! Vous avez trouvé !!        <img src="fig/eureka.PNG" width="60" />

.center[
<img src="fig/proj/selec_9" width="375" /><img src="fig/est_ensemble_implantation_map.PNG" width="575" />
]


---
class: inverse middle center

#  Mettre en page une carte

Synthèse graphique des critères mis en oeuvre dans l'atelier

Éléments fondamentaux sur l'habillage cartographique

Créer une mise en page avec QGIS

---

## Comment arriver à cette carte de synthèse ?

.center[
<img src="proj/fig/est_ensemble_carte_synthese.PNG" width="700" />
]

---
.pull-left[

## Codes et conventions cartographiques : Aider à la mise en contexte
### Des éléments obligatoires

.medium[
- Un **titre** 
- Une **date**
- Une **légende**  
- Une **source** (un **auteur**)
- Une **échelle** 
- Une **orientation** (optionnel).  
 ]

### A avoir en tête...

.medium[
- Le choix des couleurs n'est pas anodin (considérations thématiques, statistiques, culturelles, etc.)
- Les éléments graphiques doivent être hiérarchisés. 
- La **légende** résume les éléments présentés sur la carte. Celle-ci peut être organisée par sous-titres de légende pour mieux contextualiser l'information que vous présentez (*par ex : équipements existants, caractéristiques socio-économiques, distances aux équipements*).
- Ne pas trop surcharger la carte : ne pas hésiter à produire des cartes plutôt qu'une. 
- N'hésitez pas à jouer sur la transparence, les hachures, ajouter des labels, des encadrés etc. pour améliorer la lisibilité de votre carte
]
]
 
.pull-right[
<img src="fig/carte_lambert.png" width="570" />
 .leg-fig[
 Des morts par milliers aux portes de l'Europe (Source : [Lambert, 2015](https://neocarto.hypotheses.org/1370))
 ]
 ]

---

## Mise en page dans QGIS

.center[
<img src="fig/mise_en_page.png" width="900" />
]

---

## Mise en page dans QGIS

.center[
<iframe width="840" height="472.5" src="https://www.youtube.com/embed/zuYOBoMVfrI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

.leg-fig[Une vidéo (source : La Minute QGIS) qui explique les fondements de la mise en page avec QGIS]
]


---

class: inverse middle center

#  Cartographie thématique dans QGIS

Éléments fondamentaux de sémiologie graphique

Typologies (catégories)

Cartes choroplèthes (valeurs graduées, discrétisations)



---

## Les Règles de la sémiologie graphique

.center[
Le **langage cartographique** a été théorisé par **Jacques Bertin** (1967).

.pull-left[
<img src="fig/bertin_1.jpg" width="250" />
]

.pull-right[
<img src="fig/bertin_2.jpg" width="250" />
]

« ***La graphique*** *utilise les propriétés de l'image visuelle pour faire apparaître les* ***relations*** *de* ***différence***, ***d'ordre*** et de ***proportionnalité*** entre les données ».
]

---

## Les variables visuelles (6 + 1)

.pull-left[
<img src="fig/VV_valeur.png" width="450" />
<img src="fig/VV_couleur.png" width="450" />
<img src="fig/VV_taille_ordre.png" width="450" />
<img src="fig/VV_forme.png" width="450" />
]

.pull-right[
<img src="fig/VV_grain.png" width="450" />
<img src="fig/VV_orientation.png" width="450" />
<img src="fig/VV_texture_diff.png" width="450" />

.leg-fig[Source : Manuel de cartographie : principes, méthodes, applications (Lambert, Zanin, 2016)]
]


---

## Les 3 propriétes des variables visuelles

.center[
<img src="fig/VV_et_categories.png" width="700" />

.leg-fig[Source : Manuel de cartographie : principes, méthodes, applications (Lambert, Zanin, 2016)]
]

---

## Le lien entre données statistiques et variables visuelles

.center[
<img src="fig/categories-de-VV.png" width="800" />

.leg-fig[Source : Manuel de cartographie : principes, méthodes, applications (Lambert, Zanin, 2016)
]
]

---

## Le lien entre données statistiques et variables visuelles

.center[
<img src="fig/arbre_type_data.png" width="720" />
]

---

class: middle center

## Pour s'en convaincre...

.pull-left[
<img src="fig/map_failed_1.jpg" width="450" />
]

.pull-right[
<img src="fig/map_failed_2.jpg" width="450" />
]

---

class: middle center

## Pour s'en convaincre...

.pull-left[
<img src="fig/map_failed_3.jpg" width="400" />
]

--

.pull-right[
<img src="fig/map_failed_4.jpg" width="400" />
]

---


.left-column[

## Variables quantitatives relatives : nécessité de discrétiser

La **discrétisation** est un mode de *simplification de l'information* (quantitative continue) pour la rendre intelligible.
]

.right-column[
![](fig/discretisation.png)
]

---

## Deux objectifs

.pull-left[
### Conserver l'essentiel de l'information

* **Regrouper les valeurs qui se ressemblent** et qui sont différentes des autres ; donner des **seuils** qui ont du sens

* Conserver l'ordre de grandeur, la dispersion, la forme de la distribution

* Rendre compte de la **structure interne** du jeu de données
]

.pull-right[
### Transmettre l'information

* Limiter le nombre de classes

$$N(cl) = 1 + 3,3 \log10(N)$$

où $N$ est le nombre d'observations et $N(cl)$ le nombre de classes

* Faciliter la mémorisation

On a coutume de dire que 10 classes est un maximum.

* Construire une carte qui "raconte" quelque-chose !
]

---

## Quelques principes fondamentaux : >> Compromis entre **information** et **démonstration** 

* Les classes ne doivent **pas être vides**

* Les classes doivent couvrir l'**ensemble** de la distribution, et être **contiguës** (elles s'arrêtent là où une autre commence)

* Les classes doivent être  **distinctes** (les valeurs ne doivent pas se superposer)

* Les caractéristiques essentielles de la distribution de l'indicateur doivent être conservées, et permettre de perdre le moins d'information possible.

* Le nombre de classes doit être inférieur au nombre d'observations

---

## Les méthodes

.pull-left[

![](fig/discretisation_tableau_methodes.png)

]

.pull-right[
![](fig/discretisation_italie.png)
]


---
class: inverse middle center

#  Pour aller plus loin...

Digitalisation

Statistiques spatiales

Cartes avec Magrit




---
## Digitalisation

.pull-left[
La digitalisation consiste à **numériser des points à partir d'un support visuel**, en attribuant à chaque point des coordonnées X et Y dans un système de projection quelconque.

Elle peut être réalisée avec deux méthodes : la digitalisation sur table à digitaliser ou directement sur un écran à partir d'une source numérisée. 

L'une des bases de départ des SIG est le plan cadastre digitalisé.

La digitalisation nécessite beaucoup de méthode, de pratique et de précaution (éviter les erreurs topologiques, chevauchement des polygones, etc.). Sa pratique ne sera pas abordée dans ce cours.]

.pull-right[
<img src="fig/digitalisation5.PNG" width="390" />

.leg-fig[
Pour en savoir plus, se reporter à [ce document](https://hal.inrae.fr/hal-02791101/document) sur la digitalisation et le géoréférencement de cartes d'État Major ou à [celui-ci]((https://oatao.univ-toulouse.fr/16382/1/Grel_16382.pdf)) pour une application à l'analyse du couvert forestier (source : INRA).
]
]

---

## Digitalisation

.center[
<img src="fig/digitalisation3.PNG" width="800" />
]

---

## Digitalisation

.center[
<iframe width="840" height="472.5" src="https://www.youtube.com/embed/uFaN-uDv90s" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

.leg-fig[Une vidéo (source : CADGIS network) qui explique comment digitaliser une image géoréfrencée avec QGIS)]
]


---

## Quels logiciels pour quelle cartographie ?
.pull-left[
.center[**Logiciels de cartographie**

<img src="fig/carto_logicielscarto.PNG" width="200"/>]

.medium[
* Environnement logiciel complètement **dédié à la création cartographique*</u>**.

* **Cartographie de base** (réflexion poussée sur les choix statistiques)

* Variété des méthodes de représentation

* **Partage et diffusion** (« une belle carte »).

* Interface épurée.]

.center[*Des logiciels dédiés pour la création cartographique*]
]

.pull-right[
.center[**Systèmes d'information géographique**


<img src="fig/carto_logicielssig.PNG" width="200"/>]

.medium[
* Gestion de **bases de données** géographiques.

* Visualisation et superposition des **couches** géographiques.

* **Géotraitements**.

* Cartographie de base (cartes choroplèthes, typologies, figurés proportionnels).]

.center[*Réaliser une carte thématique de qualité est possible dans un environnement SIG, mais ce n’est pas l’objet premier de ce type de logiciels*]
]

---

## Magrit

.center[.big[en ligne : [http://magrit.cnrs.fr](magrit.cnrs.fr)]]

![](fig/magrit_page.png)

---

## L'interface Magrit


<img src="fig/magrit_project.PNG" width="700" />

---
class: middle center inverse

# Ressources

---

class: center

## Systèmes d'information géographique

<img src="fig/ref_4.png" height="450"  />
<img src="fig/ref_5.jpeg" height="450" />


---

class: center

## Cartographie thématique

<img src="fig/ref_1.jpg" height="450" />
<img src="fig/ref_2.jpg" height="450" />
<img src="fig/ref_3.jpg" height="450" />

---
class: middle center

# A vous de jouer ! 

<center>


Présentation accessible et diffusable à l'adresse
[rysebaert.github.io/qgis_data_shs](https://rysebaert.github.io/qgis_data_shs) 

</center>

<br><br><br><br>

.pull-left[
.medium[
|                                                                                                            |                                   |
| :--------------------------------------------------------------------------------------------------------- | :-------------------------------- |
| `r icons::fontawesome("envelope")` | [ronan.ysebaert@cnrs.fr](mailto:ronan.ysebaert@cnrs.fr)       |
| `r icons::fontawesome("home")` | [riate.cnrs.fr](https://riate.cnrs.fr/) |
| `r icons::fontawesome("gitlab")` | [gitlab.huma-num.fr/rysebaert](https://gitlab.huma-num.fr/rysebaert)                         |
| `r icons::fontawesome("github")` | [@rysebaert](https://github.com/rysebaert) |


]]

.pull-right[
.medium[
|                                                                                                            |                                   |
| :--------------------------------------------------------------------------------------------------------- | :-------------------------------- |
| `r icons::fontawesome("envelope")` | [violaine.jurie@univ-paris-diderot.fr](mailto:violaine.jurie@univ-paris-diderot.fr)       |
| `r icons::fontawesome("home")` | [geoteca.u-paris.fr/](https://geoteca.u-paris.fr/) |

]]

